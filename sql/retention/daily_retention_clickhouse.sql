-- üìò –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Ä–∞—Å—á–µ—Ç –¥–Ω–µ–≤–Ω–æ–≥–æ —Ä–µ—Ç–µ–Ω—à–µ–Ω–∞ (Retention) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º
-- üß† Retention = –¥–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –∏–≥—Ä—É/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ X –¥–Ω–µ–π –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
-- üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: ClickHouse
-- üë§ –ê–≤—Ç–æ—Ä: Mikhail
-- üìÖ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-10-24

/* 
üß© –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å:
   1Ô∏è‚É£ –ë–µ—Ä–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö —Å–æ–±—ã—Ç–∏—è (event_date, install_date)
   2Ô∏è‚É£ –°—á–∏—Ç–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
   3Ô∏è‚É£ –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É "–∫–æ—Ö–æ—Ä—Ç–∞ √ó –¥–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏" –¥–ª—è Retention-–≥—Ä–∞—Ñ–∏–∫–∞
*/

SELECT
    install_date,                      -- –¥–µ–Ω—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∫–æ–≥–æ—Ä—Ç–∞)
    event_date,                        -- –¥–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    COUNT(DISTINCT user_id) AS active_users  -- —Å–∫–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∞–∫—Ç–∏–≤–Ω—ã –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å
FROM events
WHERE event_date >= install_date       -- —Å–æ–±—ã—Ç–∏—è –Ω–µ —Ä–∞–Ω—å—à–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
  AND event_date < install_date + INTERVAL 7 DAY   -- –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: —Å–º–æ—Ç—Ä–∏–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 7 –¥–Ω–µ–π
GROUP BY install_date, event_date       -- –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –¥–∞—Ç–µ —Å–æ–±—ã—Ç–∏—è
ORDER BY install_date, event_date;      -- —Å–æ—Ä—Ç–∏—Ä—É–µ–º, —á—Ç–æ–±—ã —Å—Ç—Ä–æ–∫–∏ —à–ª–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É (—É–¥–æ–±–Ω–æ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤)

/*
üìä –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:

| install_date | event_date  | active_users |
|---------------|-------------|--------------|
| 2025-10-10    | 2025-10-10  | 1500         | ‚Üê –¥–µ–Ω—å 0 (Day 0 Retention)
| 2025-10-10    | 2025-10-11  | 600          | ‚Üê –¥–µ–Ω—å 1 (Day 1 Retention)
| 2025-10-10    | 2025-10-12  | 300          | ‚Üê –¥–µ–Ω—å 2 (Day 2 Retention)
| ...           | ...         | ...          |

üí° –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ–ª—é (active_users / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–æ–≥–æ—Ä—Ç–µ Day0)
   ‚Äî –≤ Python, BI –∏–ª–∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–º SQL.
*/
